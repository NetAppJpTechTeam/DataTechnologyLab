

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Helmの初期化 &mdash; NetApp Digital Transformation Lab 18.08 NDX vol2 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom-width.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> NetApp Digital Transformation Lab
          

          
            
            <img src="../_static/netapp_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                18.08
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Level0/index.html">Level 0: 環境の確認・基本操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Level1/index.html">Level 1: アプリケーションをコンテナ化する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Level2/index.html">Level 2: ステートフルコンテナの実現</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Level 3: CI／CDパイプラインを構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Level4/index.html">Level 4: 運用編</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Level5/index.html">Level 5: Microservice化</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../others/cmdreferences.html">コマンドリファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../others/terms.html">用語集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../others/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Level4/ingress/ingress.html">Ingressを導入</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../others/installed.html">Installed apps</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../others/todos.html">ToDos</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../others/design.html">Design: kubernetes クラスタの設計要素について</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NetApp Digital Transformation Lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Helmの初期化</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Level3/jenkins-install-with-helm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="helm">
<h1>Helmの初期化<a class="headerlink" href="#helm" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Helmを使用する事前の設定をします。
Helmの初期化、RBACの設定を実施します。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> helm init
<span class="gp">$</span> kubectl create clusterrolebinding add-on-cluster-admin --clusterrole<span class="o">=</span>cluster-admin --serviceaccount<span class="o">=</span>kube-system:default
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h1>Helmの基本<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>基本的なHelmの使い方は以下の通りです。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> helm install stable/helm-chart名
</pre></div>
</div>
</div>
<div class="section" id="helmjenkins">
<h1>Helmチャートのインストール・Jenkinsのカスタマイズ<a class="headerlink" href="#helmjenkins" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>今回はJenkinsを導入するにあたり環境に併せてカスタマイズを行います。
Helmは以下のURLに様々なものが公開されています。パラメータを与えることである程度カスタマイズし使用することができます。
Helm chartと同等のディレクトリにvalues.yamlというファイルが存在し、これを環境に併せて変更することでカスタマイズしデプロイできます。</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/kubernetes/charts">https://github.com/kubernetes/charts</a></li>
</ul>
<p>今回のJenkinsのデプロイでは2つの公開方法が選択できます。</p>
<p>1つ目が、今回の環境では <code class="docutils literal notranslate"><span class="pre">Service</span></code> の <code class="docutils literal notranslate"><span class="pre">type</span></code> を <code class="docutils literal notranslate"><span class="pre">LoadBalancer</span></code> としてしてデプロイすると external-ipが付与される環境となっています。(MetalLBをデプロイ済みです。)</p>
<p>2つ目が <code class="docutils literal notranslate"><span class="pre">Ingress</span></code> を使った公開です。IngressをJenkinsのHelmチャートを使ってデプロイするためには「Master.Ingress.Annotations」、「Master.ServiceType」を変更しデプロイします。</p>
<p>簡易的にデプロイをためしてみたい方は1つ目の <code class="docutils literal notranslate"><span class="pre">LoadBalancer</span></code> を使ったやり方を実施、新しい概念であるIngressを使った方法を実施したい方は2つ目を選択しましょう。</p>
<p>どちらの方法の場合も、以下のvalues.yamlをカスタマイズしてデプロイします。
このレベルではJenkinsをデプロイするのが目的ではなくCI/CDパイプラインを作成するのが目的であるため、デプロイ用のyamlファイルを準備しました。</p>
<p>また、このvalues.yamlでは永続化ストレージが定義されていないため、Level2で作成したStorageClassを使用し動的にプロビジョニングをするように変更しましょう。</p>
<p>StorageClassには環境に作成したStorageClassを設定します。このサンプルでは &quot;ontap-gold&quot;を設定してあります。</p>
<p>また、Kubernetes上でCI/CDパイプラインを作成するため <code class="docutils literal notranslate"><span class="pre">Kubernetes-plugin</span></code> もyamlファイルに追記済みです。</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Helm設定用のvalues.yaml</span><a class="headerlink" href="#id3" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default values for jenkins.</span>
<span class="c1"># This is a YAML-formatted file.</span>
<span class="c1"># Declare name/value pairs to be passed into your templates.</span>
<span class="c1"># name: value</span>

<span class="c1">## Overrides for generated resource names</span>
<span class="c1"># See templates/_helpers.tpl</span>
<span class="c1"># nameOverride:</span>
<span class="c1"># fullnameOverride:</span>

<span class="l l-Scalar l-Scalar-Plain">Master</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins-master</span>
  <span class="l l-Scalar l-Scalar-Plain">Image</span><span class="p p-Indicator">:</span> <span class="s">&quot;jenkins/jenkins&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">ImageTag</span><span class="p p-Indicator">:</span> <span class="s">&quot;lts&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">ImagePullPolicy</span><span class="p p-Indicator">:</span> <span class="s">&quot;Always&quot;</span>
  <span class="c1"># ImagePullSecret: jenkins</span>
  <span class="l l-Scalar l-Scalar-Plain">Component</span><span class="p p-Indicator">:</span> <span class="s">&quot;jenkins-master&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">UseSecurity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">AdminUser</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
  <span class="c1"># AdminPassword: &lt;defaults to random&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">requests</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;50m&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;256Mi&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">limits</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;2000m&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;2048Mi&quot;</span>
  <span class="c1"># Environment variables that get added to the init container (useful for e.g. http_proxy)</span>
  <span class="c1"># InitContainerEnv:</span>
  <span class="c1">#   - name: http_proxy</span>
  <span class="c1">#     value: &quot;http://192.168.64.1:3128&quot;</span>
  <span class="c1"># ContainerEnv:</span>
  <span class="c1">#   - name: http_proxy</span>
  <span class="c1">#     value: &quot;http://192.168.64.1:3128&quot;</span>
  <span class="c1"># Set min/max heap here if needed with:</span>
  <span class="c1"># JavaOpts: &quot;-Xms512m -Xmx512m&quot;</span>
  <span class="c1"># JenkinsOpts: &quot;&quot;</span>
  <span class="c1"># JenkinsUriPrefix: &quot;/jenkins&quot;</span>
  <span class="c1"># Enable pod security context (must be `true` if RunAsUser or FsGroup are set)</span>
  <span class="l l-Scalar l-Scalar-Plain">UsePodSecurityContext</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="c1"># Set RunAsUser to 1000 to let Jenkins run as non-root user &#39;jenkins&#39; which exists in &#39;jenkins/jenkins&#39; docker image.</span>
  <span class="c1"># When setting RunAsUser to a different value than 0 also set FsGroup to the same value:</span>
  <span class="c1"># RunAsUser: &lt;defaults to 0&gt;</span>
  <span class="c1"># FsGroup: &lt;will be omitted in deployment if RunAsUser is 0&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">ServicePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
  <span class="c1"># For minikube, set this to NodePort, elsewhere use LoadBalancer</span>
  <span class="c1"># Use ClusterIP if your setup includes ingress controller</span>
  <span class="l l-Scalar l-Scalar-Plain">ServiceType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
  <span class="c1"># Master Service annotations</span>
  <span class="l l-Scalar l-Scalar-Plain">ServiceAnnotations</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="c1">#   service.beta.kubernetes.io/aws-load-balancer-backend-protocol: https</span>
  <span class="c1"># Used to create Ingress record (should used with ServiceType: ClusterIP)</span>
  <span class="c1"># HostName: jenkins.cluster.local</span>
  <span class="c1"># NodePort: &lt;to set explicitly, choose port between 30000-32767</span>
  <span class="c1"># Enable Kubernetes Liveness and Readiness Probes</span>
  <span class="c1"># ~ 2 minutes to allow Jenkins to restart when upgrading plugins. Set ReadinessTimeout to be shorter than LivenessTimeout.</span>
  <span class="l l-Scalar l-Scalar-Plain">HealthProbes</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">HealthProbesLivenessTimeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">90</span>
  <span class="l l-Scalar l-Scalar-Plain">HealthProbesReadinessTimeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
  <span class="l l-Scalar l-Scalar-Plain">HealthProbeLivenessFailureThreshold</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
  <span class="l l-Scalar l-Scalar-Plain">SlaveListenerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
  <span class="l l-Scalar l-Scalar-Plain">DisabledAgentProtocols</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">JNLP-connect</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">JNLP2-connect</span>
  <span class="l l-Scalar l-Scalar-Plain">CSRF</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">DefaultCrumbIssuer</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">Enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">ProxyCompatability</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">CLI</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="c1"># Kubernetes service type for the JNLP slave service</span>
  <span class="c1"># SETTING THIS TO &quot;LoadBalancer&quot; IS A HUGE SECURITY RISK: https://github.com/kubernetes/charts/issues/1341</span>
  <span class="l l-Scalar l-Scalar-Plain">SlaveListenerServiceType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
  <span class="l l-Scalar l-Scalar-Plain">SlaveListenerServiceAnnotations</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">LoadBalancerSourceRanges</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
  <span class="c1"># Optionally assign a known public LB IP</span>
  <span class="c1"># LoadBalancerIP: 1.2.3.4</span>
  <span class="c1"># Optionally configure a JMX port</span>
  <span class="c1"># requires additional JavaOpts, ie</span>
  <span class="c1"># JavaOpts: &gt;</span>
  <span class="c1">#   -Dcom.sun.management.jmxremote.port=4000</span>
  <span class="c1">#   -Dcom.sun.management.jmxremote.authenticate=false</span>
  <span class="c1">#   -Dcom.sun.management.jmxremote.ssl=false</span>
  <span class="c1"># JMXPort: 4000</span>
  <span class="c1"># List of plugins to be install during Jenkins master start</span>
  <span class="l l-Scalar l-Scalar-Plain">InstallPlugins</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes:1.12.3</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">workflow-job:2.24</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">workflow-aggregator:2.5</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">credentials-binding:1.16</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">git:3.9.1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">blueocean:1.8.2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ghprb:1.40.0</span>

  <span class="c1"># Used to approve a list of groovy functions in pipelines used the script-security plugin. Can be viewed under /scriptApproval</span>
  <span class="c1"># ScriptApproval:</span>
  <span class="c1">#   - &quot;method groovy.json.JsonSlurperClassic parseText java.lang.String&quot;</span>
  <span class="c1">#   - &quot;new groovy.json.JsonSlurperClassic&quot;</span>
  <span class="c1"># List of groovy init scripts to be executed during Jenkins master start</span>
  <span class="l l-Scalar l-Scalar-Plain">InitScripts</span><span class="p p-Indicator">:</span>
  <span class="c1">#  - |</span>
  <span class="c1">#    print &#39;adding global pipeline libraries, register properties, bootstrap jobs...&#39;</span>
  <span class="c1"># Kubernetes secret that contains a &#39;credentials.xml&#39; for Jenkins</span>
  <span class="c1"># CredentialsXmlSecret: jenkins-credentials</span>
  <span class="c1"># Kubernetes secret that contains files to be put in the Jenkins &#39;secrets&#39; directory,</span>
  <span class="c1"># useful to manage encryption keys used for credentials.xml for instance (such as</span>
  <span class="c1"># master.key and hudson.util.Secret)</span>
  <span class="c1"># SecretsFilesSecret: jenkins-secrets</span>
  <span class="c1"># Jenkins XML job configs to provision</span>
  <span class="c1"># Jobs: |-</span>
  <span class="c1">#   test: |-</span>
  <span class="c1">#     &lt;&lt;xml here&gt;&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">CustomConfigMap</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="c1"># Node labels and tolerations for pod assignment</span>
  <span class="c1"># ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector</span>
  <span class="c1"># ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#taints-and-tolerations-beta-feature</span>
  <span class="l l-Scalar l-Scalar-Plain">NodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">Tolerations</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">PodAnnotations</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>

  <span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ApiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
    <span class="l l-Scalar l-Scalar-Plain">Annotations</span><span class="p p-Indicator">:</span>
    <span class="c1"># kubernetes.io/ingress.class: nginx</span>
    <span class="c1"># kubernetes.io/tls-acme: &quot;true&quot;</span>

    <span class="l l-Scalar l-Scalar-Plain">TLS</span><span class="p p-Indicator">:</span>
    <span class="c1"># - secretName: jenkins.cluster.local</span>
    <span class="c1">#   hosts:</span>
    <span class="c1">#     - jenkins.cluster.local</span>

<span class="l l-Scalar l-Scalar-Plain">Agent</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">Enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">Image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins/jnlp-slave</span>
  <span class="l l-Scalar l-Scalar-Plain">ImageTag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3.10-1</span>
  <span class="c1"># ImagePullSecret: jenkins</span>
  <span class="l l-Scalar l-Scalar-Plain">Component</span><span class="p p-Indicator">:</span> <span class="s">&quot;jenkins-slave&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">Privileged</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">requests</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;200m&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;256Mi&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">limits</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;200m&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;256Mi&quot;</span>
  <span class="c1"># You may want to change this to true while testing a new image</span>
  <span class="l l-Scalar l-Scalar-Plain">AlwaysPullImage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="c1"># Controls how slave pods are retained after the Jenkins build completes</span>
  <span class="c1"># Possible values: Always, Never, OnFailure</span>
  <span class="l l-Scalar l-Scalar-Plain">PodRetention</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>
  <span class="c1"># You can define the volumes that you want to mount for this container</span>
  <span class="c1"># Allowed types are: ConfigMap, EmptyDir, HostPath, Nfs, Pod, Secret</span>
  <span class="c1"># Configure the attributes as they appear in the corresponding Java class for that type</span>
  <span class="c1"># https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/main/java/org/csanchez/jenkins/plugins/kubernetes/volumes</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="c1"># - type: Secret</span>
  <span class="c1">#   secretName: mysecret</span>
  <span class="c1">#   mountPath: /var/myapp/mysecret</span>
  <span class="l l-Scalar l-Scalar-Plain">NodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="c1"># Key Value selectors. Ex:</span>
  <span class="c1"># jenkins-agent: v1</span>

<span class="l l-Scalar l-Scalar-Plain">Persistence</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">Enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="c1">## A manually managed Persistent Volume and Claim</span>
  <span class="c1">## Requires Persistence.Enabled: true</span>
  <span class="c1">## If defined, PVC must be created manually before volume will be bound</span>
  <span class="c1"># ExistingClaim:</span>

  <span class="c1">## jenkins data Persistent Volume Storage Class</span>
  <span class="c1">## If defined, storageClassName: &lt;storageClass&gt;ls</span>
  <span class="c1">## If set to &quot;-&quot;, storageClassName: &quot;&quot;, which disables dynamic provisioning</span>
  <span class="c1">## If undefined (the default) or set to null, no storageClassName spec is</span>
  <span class="c1">##   set, choosing the default provisioner.  (gp2 on AWS, standard on</span>
  <span class="c1">##   GKE, AWS &amp; OpenStack)</span>
  <span class="c1">##</span>
  <span class="l l-Scalar l-Scalar-Plain">StorageClass</span><span class="p p-Indicator">:</span> <span class="s">&quot;ontap-gold&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">Annotations</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">AccessMode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="l l-Scalar l-Scalar-Plain">Size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8Gi</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="c1">#  - name: nothing</span>
  <span class="c1">#    emptyDir: {}</span>
  <span class="l l-Scalar l-Scalar-Plain">mounts</span><span class="p p-Indicator">:</span>
  <span class="c1">#  - mountPath: /var/nothing</span>
  <span class="c1">#    name: nothing</span>
  <span class="c1">#    readOnly: true</span>

<span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span><span class="p p-Indicator">:</span>
  <span class="c1"># Enable creation of NetworkPolicy resources.</span>
  <span class="l l-Scalar l-Scalar-Plain">Enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="c1"># For Kubernetes v1.4, v1.5 and v1.6, use &#39;extensions/v1beta1&#39;</span>
  <span class="c1"># For Kubernetes v1.7, use &#39;networking.k8s.io/v1&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">ApiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>

<span class="c1">## Install Default RBAC roles and bindings</span>
<span class="l l-Scalar l-Scalar-Plain">rbac</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">serviceAccountName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="c1"># RBAC api version (currently either v1, v1beta1, or v1alpha1)</span>
  <span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
  <span class="c1"># Role reference</span>
  <span class="l l-Scalar l-Scalar-Plain">roleRef</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
  <span class="c1"># Role kind (RoleBinding or ClusterRoleBinding)</span>
  <span class="l l-Scalar l-Scalar-Plain">roleBindingKind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
</pre></div>
</div>
</div>
<p>実行イメージとしては以下の通りです。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> helm --namespace jenkins --name jenkins -f ./jenkins-values.yaml install stable/jenkins --debug
<span class="go">[debug] Created tunnel using local port: &#39;44511&#39;</span>

<span class="go">[debug] SERVER: &quot;127.0.0.1:44511&quot;</span>

<span class="go">[debug] Original chart version: &quot;&quot;</span>
<span class="go">[debug] Fetched stable/jenkins to /home/localadmin/.helm/cache/archive/jenkins-0.16.20.tgz</span>

<span class="go">[debug] CHART PATH: /home/localadmin/.helm/cache/archive/jenkins-0.16.20.tgz</span>

<span class="go">NAME:   jenkins</span>
<span class="go">REVISION: 1</span>
<span class="go">RELEASED: Mon Aug 27 23:54:09 2018</span>
<span class="go">CHART: jenkins-0.16.20</span>
<span class="go">USER-SUPPLIED VALUES:</span>
<span class="go">Agent:</span>
<span class="go">  AlwaysPullImage: false</span>
<span class="go">  Component: jenkins-slave</span>
<span class="go">  Enabled: true</span>
<span class="go">  Image: jenkins/jnlp-slave</span>
<span class="go">  ImageTag: 3.10-1</span>
<span class="go">  NodeSelector: {}</span>
<span class="go">  PodRetention: Never</span>
<span class="go">  Privileged: false</span>
<span class="go">  resources:</span>
<span class="go">    limits:</span>
<span class="go">      cpu: 200m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">    requests:</span>
<span class="go">      cpu: 200m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">  volumes: null</span>
<span class="go">Master:</span>
<span class="go">  AdminUser: admin</span>
<span class="go">  CLI: false</span>
<span class="go">  CSRF:</span>
<span class="go">    DefaultCrumbIssuer:</span>
<span class="go">      Enabled: true</span>
<span class="go">      ProxyCompatability: true</span>
<span class="go">  Component: jenkins-master</span>
<span class="go">  CustomConfigMap: false</span>
<span class="go">  DisabledAgentProtocols:</span>
<span class="go">  - JNLP-connect</span>
<span class="go">  - JNLP2-connect</span>
<span class="go">  HealthProbeLivenessFailureThreshold: 12</span>
<span class="go">  HealthProbes: true</span>
<span class="go">  HealthProbesLivenessTimeout: 90</span>
<span class="go">  HealthProbesReadinessTimeout: 60</span>
<span class="go">  Image: jenkins/jenkins</span>
<span class="go">  ImagePullPolicy: Always</span>
<span class="go">  ImageTag: lts</span>
<span class="go">  Ingress:</span>
<span class="go">    Annotations: null</span>
<span class="go">    ApiVersion: extensions/v1beta1</span>
<span class="go">    TLS: null</span>
<span class="go">  InitScripts: null</span>
<span class="go">  InstallPlugins:</span>
<span class="go">  - kubernetes:1.12.3</span>
<span class="go">  - workflow-job:2.24</span>
<span class="go">  - workflow-aggregator:2.5</span>
<span class="go">  - credentials-binding:1.16</span>
<span class="go">  - git:3.9.1</span>
<span class="go">  - blueocean:1.4.1</span>
<span class="go">  - ghprb:1.40.0</span>
<span class="go">  LoadBalancerSourceRanges:</span>
<span class="go">  - 0.0.0.0/0</span>
<span class="go">  Name: jenkins-master</span>
<span class="go">  NodeSelector: {}</span>
<span class="go">  PodAnnotations: {}</span>
<span class="go">  ServiceAnnotations: {}</span>
<span class="go">  ServicePort: 8080</span>
<span class="go">  ServiceType: LoadBalancer</span>
<span class="go">  SlaveListenerPort: 50000</span>
<span class="go">  SlaveListenerServiceAnnotations: {}</span>
<span class="go">  SlaveListenerServiceType: ClusterIP</span>
<span class="go">  Tolerations: {}</span>
<span class="go">  UsePodSecurityContext: true</span>
<span class="go">  UseSecurity: true</span>
<span class="go">  resources:</span>
<span class="go">    limits:</span>
<span class="go">      cpu: 2000m</span>
<span class="go">      memory: 2048Mi</span>
<span class="go">    requests:</span>
<span class="go">      cpu: 50m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">NetworkPolicy:</span>
<span class="go">  ApiVersion: extensions/v1beta1</span>
<span class="go">  Enabled: false</span>
<span class="go">Persistence:</span>
<span class="go">  AccessMode: ReadWriteOnce</span>
<span class="go">  Annotations: {}</span>
<span class="go">  Enabled: true</span>
<span class="go">  Size: 8Gi</span>
<span class="go">  StorageClass: ontap-gold</span>
<span class="go">  mounts: null</span>
<span class="go">  volumes: null</span>
<span class="go">rbac:</span>
<span class="go">  apiVersion: v1</span>
<span class="go">  install: false</span>
<span class="go">  roleBindingKind: ClusterRoleBinding</span>
<span class="go">  roleRef: cluster-admin</span>
<span class="go">  serviceAccountName: default</span>

<span class="go">COMPUTED VALUES:</span>
<span class="go">Agent:</span>
<span class="go">  AlwaysPullImage: false</span>
<span class="go">  Component: jenkins-slave</span>
<span class="go">  Enabled: true</span>
<span class="go">  Image: jenkins/jnlp-slave</span>
<span class="go">  ImageTag: 3.10-1</span>
<span class="go">  NodeSelector: {}</span>
<span class="go">  PodRetention: Never</span>
<span class="go">  Privileged: false</span>
<span class="go">  resources:</span>
<span class="go">    limits:</span>
<span class="go">      cpu: 200m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">    requests:</span>
<span class="go">      cpu: 200m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">  volumes: null</span>
<span class="go">Master:</span>
<span class="go">  AdminUser: admin</span>
<span class="go">  CLI: false</span>
<span class="go">  CSRF:</span>
<span class="go">    DefaultCrumbIssuer:</span>
<span class="go">      Enabled: true</span>
<span class="go">      ProxyCompatability: true</span>
<span class="go">  Component: jenkins-master</span>
<span class="go">  CustomConfigMap: false</span>
<span class="go">  DisabledAgentProtocols:</span>
<span class="go">  - JNLP-connect</span>
<span class="go">  - JNLP2-connect</span>
<span class="go">  HealthProbeLivenessFailureThreshold: 12</span>
<span class="go">  HealthProbes: true</span>
<span class="go">  HealthProbesLivenessTimeout: 90</span>
<span class="go">  HealthProbesReadinessTimeout: 60</span>
<span class="go">  Image: jenkins/jenkins</span>
<span class="go">  ImagePullPolicy: Always</span>
<span class="go">  ImageTag: lts</span>
<span class="go">  Ingress:</span>
<span class="go">    Annotations: null</span>
<span class="go">    ApiVersion: extensions/v1beta1</span>
<span class="go">    TLS: null</span>
<span class="go">  InitScripts: null</span>
<span class="go">  InstallPlugins:</span>
<span class="go">  - kubernetes:1.12.3</span>
<span class="go">  - workflow-job:2.24</span>
<span class="go">  - workflow-aggregator:2.5</span>
<span class="go">  - credentials-binding:1.16</span>
<span class="go">  - git:3.9.1</span>
<span class="go">  - blueocean:1.4.1</span>
<span class="go">  - ghprb:1.40.0</span>
<span class="go">  LoadBalancerSourceRanges:</span>
<span class="go">  - 0.0.0.0/0</span>
<span class="go">  Name: jenkins-master</span>
<span class="go">  NodeSelector: {}</span>
<span class="go">  PodAnnotations: {}</span>
<span class="go">  ServiceAnnotations: {}</span>
<span class="go">  ServicePort: 8080</span>
<span class="go">  ServiceType: LoadBalancer</span>
<span class="go">  SlaveListenerPort: 50000</span>
<span class="go">  SlaveListenerServiceAnnotations: {}</span>
<span class="go">  SlaveListenerServiceType: ClusterIP</span>
<span class="go">  Tolerations: {}</span>
<span class="go">  UsePodSecurityContext: true</span>
<span class="go">  UseSecurity: true</span>
<span class="go">  resources:</span>
<span class="go">    limits:</span>
<span class="go">      cpu: 2000m</span>
<span class="go">      memory: 2048Mi</span>
<span class="go">    requests:</span>
<span class="go">      cpu: 50m</span>
<span class="go">      memory: 256Mi</span>
<span class="go">NetworkPolicy:</span>
<span class="go">  ApiVersion: extensions/v1beta1</span>
<span class="go">  Enabled: false</span>
<span class="go">Persistence:</span>
<span class="go">  AccessMode: ReadWriteOnce</span>
<span class="go">  Annotations: {}</span>
<span class="go">  Enabled: true</span>
<span class="go">  Size: 8Gi</span>
<span class="go">  StorageClass: ontap-gold</span>
<span class="go">  mounts: null</span>
<span class="go">  volumes: null</span>
<span class="go">rbac:</span>
<span class="go">  apiVersion: v1</span>
<span class="go">  install: false</span>
<span class="go">  roleBindingKind: ClusterRoleBinding</span>
<span class="go">  roleRef: cluster-admin</span>
<span class="go">  serviceAccountName: default</span>

<span class="go">HOOKS:</span>
<span class="go">---</span>
<span class="gp">#</span> jenkins-ui-test-1g5nb
<span class="go">apiVersion: v1</span>
<span class="go">kind: Pod</span>
<span class="go">metadata:</span>
<span class="go">  name: &quot;jenkins-ui-test-1g5nb&quot;</span>
<span class="go">  annotations:</span>
<span class="go">    &quot;helm.sh/hook&quot;: test-success</span>
<span class="go">spec:</span>
<span class="go">  initContainers:</span>
<span class="go">    - name: &quot;test-framework&quot;</span>
<span class="go">      image: &quot;dduportal/bats:0.4.0&quot;</span>
<span class="go">      command:</span>
<span class="go">      - &quot;bash&quot;</span>
<span class="go">      - &quot;-c&quot;</span>
<span class="go">      - |</span>
<span class="go">        set -ex</span>
<span class="gp">        #</span> copy bats to tools dir
<span class="go">        cp -R /usr/local/libexec/ /tools/bats/</span>
<span class="go">      volumeMounts:</span>
<span class="go">      - mountPath: /tools</span>
<span class="go">        name: tools</span>
<span class="go">  containers:</span>
<span class="go">    - name: jenkins-ui-test</span>
<span class="go">      image: jenkins/jenkins:lts</span>
<span class="go">      command: [&quot;/tools/bats/bats&quot;, &quot;-t&quot;, &quot;/tests/run.sh&quot;]</span>
<span class="go">      volumeMounts:</span>
<span class="go">      - mountPath: /tests</span>
<span class="go">        name: tests</span>
<span class="go">        readOnly: true</span>
<span class="go">      - mountPath: /tools</span>
<span class="go">        name: tools</span>
<span class="go">  volumes:</span>
<span class="go">  - name: tests</span>
<span class="go">    configMap:</span>
<span class="go">      name: jenkins-tests</span>
<span class="go">  - name: tools</span>
<span class="go">    emptyDir: {}</span>
<span class="go">  restartPolicy: Never</span>
<span class="go">MANIFEST:</span>

<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/secret.yaml
<span class="go">apiVersion: v1</span>
<span class="go">kind: Secret</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins</span>
<span class="go">  labels:</span>
<span class="go">    app: jenkins</span>
<span class="go">    chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">    release: &quot;jenkins&quot;</span>
<span class="go">    heritage: &quot;Tiller&quot;</span>
<span class="go">type: Opaque</span>
<span class="go">data:</span>

<span class="go">  jenkins-admin-password: &quot;N3EwZWtydDAyQg==&quot;</span>

<span class="go">  jenkins-admin-user: &quot;YWRtaW4=&quot;</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/config.yaml
<span class="go">apiVersion: v1</span>
<span class="go">kind: ConfigMap</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins</span>
<span class="go">data:</span>
<span class="go">  config.xml: |-</span>
<span class="go">    &lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="go">    &lt;hudson&gt;</span>
<span class="go">      &lt;disabledAdministrativeMonitors/&gt;</span>
<span class="go">      &lt;version&gt;lts&lt;/version&gt;</span>
<span class="go">      &lt;numExecutors&gt;0&lt;/numExecutors&gt;</span>
<span class="go">      &lt;mode&gt;NORMAL&lt;/mode&gt;</span>
<span class="go">      &lt;useSecurity&gt;true&lt;/useSecurity&gt;</span>
<span class="go">      &lt;authorizationStrategy class=&quot;hudson.security.FullControlOnceLoggedInAuthorizationStrategy&quot;&gt;</span>
<span class="go">        &lt;denyAnonymousReadAccess&gt;true&lt;/denyAnonymousReadAccess&gt;</span>
<span class="go">      &lt;/authorizationStrategy&gt;</span>
<span class="go">      &lt;securityRealm class=&quot;hudson.security.LegacySecurityRealm&quot;/&gt;</span>
<span class="go">      &lt;disableRememberMe&gt;false&lt;/disableRememberMe&gt;</span>
<span class="go">      &lt;projectNamingStrategy class=&quot;jenkins.model.ProjectNamingStrategy$DefaultProjectNamingStrategy&quot;/&gt;</span>
<span class="go">      &lt;workspaceDir&gt;${JENKINS_HOME}/workspace/${ITEM_FULLNAME}&lt;/workspaceDir&gt;</span>
<span class="go">      &lt;buildsDir&gt;${ITEM_ROOTDIR}/builds&lt;/buildsDir&gt;</span>
<span class="go">      &lt;markupFormatter class=&quot;hudson.markup.EscapedMarkupFormatter&quot;/&gt;</span>
<span class="go">      &lt;jdks/&gt;</span>
<span class="go">      &lt;viewsTabBar class=&quot;hudson.views.DefaultViewsTabBar&quot;/&gt;</span>
<span class="go">      &lt;myViewsTabBar class=&quot;hudson.views.DefaultMyViewsTabBar&quot;/&gt;</span>
<span class="go">      &lt;clouds&gt;</span>
<span class="go">        &lt;org.csanchez.jenkins.plugins.kubernetes.KubernetesCloud plugin=&quot;kubernetes@1.12.3&quot;&gt;</span>
<span class="go">          &lt;name&gt;kubernetes&lt;/name&gt;</span>
<span class="go">          &lt;templates&gt;</span>
<span class="go">            &lt;org.csanchez.jenkins.plugins.kubernetes.PodTemplate&gt;</span>
<span class="go">              &lt;inheritFrom&gt;&lt;/inheritFrom&gt;</span>
<span class="go">              &lt;name&gt;default&lt;/name&gt;</span>
<span class="go">              &lt;instanceCap&gt;2147483647&lt;/instanceCap&gt;</span>
<span class="go">              &lt;idleMinutes&gt;0&lt;/idleMinutes&gt;</span>
<span class="go">              &lt;label&gt;jenkins-jenkins-slave&lt;/label&gt;</span>
<span class="go">              &lt;nodeSelector&gt;&lt;/nodeSelector&gt;</span>
<span class="go">                &lt;nodeUsageMode&gt;NORMAL&lt;/nodeUsageMode&gt;</span>
<span class="go">              &lt;volumes&gt;</span>
<span class="go">              &lt;/volumes&gt;</span>
<span class="go">              &lt;containers&gt;</span>
<span class="go">                &lt;org.csanchez.jenkins.plugins.kubernetes.ContainerTemplate&gt;</span>
<span class="go">                  &lt;name&gt;jnlp&lt;/name&gt;</span>
<span class="go">                  &lt;image&gt;jenkins/jnlp-slave:3.10-1&lt;/image&gt;</span>
<span class="go">                  &lt;privileged&gt;false&lt;/privileged&gt;</span>
<span class="go">                  &lt;alwaysPullImage&gt;false&lt;/alwaysPullImage&gt;</span>
<span class="go">                  &lt;workingDir&gt;/home/jenkins&lt;/workingDir&gt;</span>
<span class="go">                  &lt;command&gt;&lt;/command&gt;</span>
<span class="go">                  &lt;args&gt;${computer.jnlpmac} ${computer.name}&lt;/args&gt;</span>
<span class="go">                  &lt;ttyEnabled&gt;false&lt;/ttyEnabled&gt;</span>
<span class="gp">                  #</span> Resources configuration is a little hacky. This was to prevent breaking
<span class="gp">                  #</span> changes, and should be cleanned up in the future once everybody had
<span class="gp">                  #</span> enough <span class="nb">time</span> to migrate.
<span class="go">                  &lt;resourceRequestCpu&gt;200m&lt;/resourceRequestCpu&gt;</span>
<span class="go">                  &lt;resourceRequestMemory&gt;256Mi&lt;/resourceRequestMemory&gt;</span>
<span class="go">                  &lt;resourceLimitCpu&gt;200m&lt;/resourceLimitCpu&gt;</span>
<span class="go">                  &lt;resourceLimitMemory&gt;256Mi&lt;/resourceLimitMemory&gt;</span>
<span class="go">                  &lt;envVars&gt;</span>
<span class="go">                    &lt;org.csanchez.jenkins.plugins.kubernetes.ContainerEnvVar&gt;</span>
<span class="go">                      &lt;key&gt;JENKINS_URL&lt;/key&gt;</span>
<span class="go">                      &lt;value&gt;http://jenkins:8080&lt;/value&gt;</span>
<span class="go">                    &lt;/org.csanchez.jenkins.plugins.kubernetes.ContainerEnvVar&gt;</span>
<span class="go">                  &lt;/envVars&gt;</span>
<span class="go">                &lt;/org.csanchez.jenkins.plugins.kubernetes.ContainerTemplate&gt;</span>
<span class="go">              &lt;/containers&gt;</span>
<span class="go">              &lt;envVars/&gt;</span>
<span class="go">              &lt;annotations/&gt;</span>
<span class="go">              &lt;imagePullSecrets/&gt;</span>
<span class="go">              &lt;nodeProperties/&gt;</span>
<span class="go">              &lt;podRetention class=&quot;org.csanchez.jenkins.plugins.kubernetes.pod.retention.Default&quot;/&gt;</span>
<span class="go">            &lt;/org.csanchez.jenkins.plugins.kubernetes.PodTemplate&gt;&lt;/templates&gt;</span>
<span class="go">          &lt;serverUrl&gt;https://kubernetes.default&lt;/serverUrl&gt;</span>
<span class="go">          &lt;skipTlsVerify&gt;false&lt;/skipTlsVerify&gt;</span>
<span class="go">          &lt;namespace&gt;jenkins&lt;/namespace&gt;</span>
<span class="go">          &lt;jenkinsUrl&gt;http://jenkins:8080&lt;/jenkinsUrl&gt;</span>
<span class="go">          &lt;jenkinsTunnel&gt;jenkins-agent:50000&lt;/jenkinsTunnel&gt;</span>
<span class="go">          &lt;containerCap&gt;10&lt;/containerCap&gt;</span>
<span class="go">          &lt;retentionTimeout&gt;5&lt;/retentionTimeout&gt;</span>
<span class="go">          &lt;connectTimeout&gt;0&lt;/connectTimeout&gt;</span>
<span class="go">          &lt;readTimeout&gt;0&lt;/readTimeout&gt;</span>
<span class="go">          &lt;podRetention class=&quot;org.csanchez.jenkins.plugins.kubernetes.pod.retention.Never&quot;/&gt;</span>
<span class="go">        &lt;/org.csanchez.jenkins.plugins.kubernetes.KubernetesCloud&gt;</span>
<span class="go">      &lt;/clouds&gt;</span>
<span class="go">      &lt;quietPeriod&gt;5&lt;/quietPeriod&gt;</span>
<span class="go">      &lt;scmCheckoutRetryCount&gt;0&lt;/scmCheckoutRetryCount&gt;</span>
<span class="go">      &lt;views&gt;</span>
<span class="go">        &lt;hudson.model.AllView&gt;</span>
<span class="go">          &lt;owner class=&quot;hudson&quot; reference=&quot;../../..&quot;/&gt;</span>
<span class="go">          &lt;name&gt;All&lt;/name&gt;</span>
<span class="go">          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;</span>
<span class="go">          &lt;filterQueue&gt;false&lt;/filterQueue&gt;</span>
<span class="go">          &lt;properties class=&quot;hudson.model.View$PropertyList&quot;/&gt;</span>
<span class="go">        &lt;/hudson.model.AllView&gt;</span>
<span class="go">      &lt;/views&gt;</span>
<span class="go">      &lt;primaryView&gt;All&lt;/primaryView&gt;</span>
<span class="go">      &lt;slaveAgentPort&gt;50000&lt;/slaveAgentPort&gt;</span>
<span class="go">      &lt;disabledAgentProtocols&gt;</span>
<span class="go">        &lt;string&gt;JNLP-connect&lt;/string&gt;</span>
<span class="go">        &lt;string&gt;JNLP2-connect&lt;/string&gt;</span>
<span class="go">      &lt;/disabledAgentProtocols&gt;</span>
<span class="go">      &lt;label&gt;&lt;/label&gt;</span>
<span class="go">      &lt;crumbIssuer class=&quot;hudson.security.csrf.DefaultCrumbIssuer&quot;&gt;</span>
<span class="go">        &lt;excludeClientIPFromCrumb&gt;true&lt;/excludeClientIPFromCrumb&gt;</span>
<span class="go">      &lt;/crumbIssuer&gt;</span>
<span class="go">      &lt;nodeProperties/&gt;</span>
<span class="go">      &lt;globalNodeProperties/&gt;</span>
<span class="go">      &lt;noUsageStatistics&gt;true&lt;/noUsageStatistics&gt;</span>
<span class="go">    &lt;/hudson&gt;</span>
<span class="go">  jenkins.model.JenkinsLocationConfiguration.xml: |-</span>
<span class="go">    &lt;?xml version=&#39;1.1&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="go">    &lt;jenkins.model.JenkinsLocationConfiguration&gt;</span>
<span class="go">      &lt;adminAddress&gt;&lt;/adminAddress&gt;</span>
<span class="go">      &lt;jenkinsUrl&gt;http://jenkins:8080&lt;/jenkinsUrl&gt;</span>
<span class="go">    &lt;/jenkins.model.JenkinsLocationConfiguration&gt;</span>
<span class="go">  jenkins.CLI.xml: |-</span>
<span class="go">    &lt;?xml version=&#39;1.1&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="go">    &lt;jenkins.CLI&gt;</span>
<span class="go">      &lt;enabled&gt;false&lt;/enabled&gt;</span>
<span class="go">    &lt;/jenkins.CLI&gt;</span>
<span class="go">  apply_config.sh: |-</span>
<span class="go">    mkdir -p /usr/share/jenkins/ref/secrets/;</span>
<span class="go">    echo &quot;false&quot; &gt; /usr/share/jenkins/ref/secrets/slave-to-master-security-kill-switch;</span>
<span class="go">    cp -n /var/jenkins_config/config.xml /var/jenkins_home;</span>
<span class="go">    cp -n /var/jenkins_config/jenkins.CLI.xml /var/jenkins_home;</span>
<span class="go">    cp -n /var/jenkins_config/jenkins.model.JenkinsLocationConfiguration.xml /var/jenkins_home;</span>
<span class="gp">    #</span> Install missing plugins
<span class="go">    cp /var/jenkins_config/plugins.txt /var/jenkins_home;</span>
<span class="go">    rm -rf /usr/share/jenkins/ref/plugins/*.lock</span>
<span class="go">    /usr/local/bin/install-plugins.sh `echo $(cat /var/jenkins_home/plugins.txt)`;</span>
<span class="gp">    #</span> Copy plugins to shared volume
<span class="go">    cp -n /usr/share/jenkins/ref/plugins/* /var/jenkins_plugins;</span>
<span class="go">  plugins.txt: |-</span>
<span class="go">    kubernetes:1.12.3</span>
<span class="go">    workflow-job:2.24</span>
<span class="go">    workflow-aggregator:2.5</span>
<span class="go">    credentials-binding:1.16</span>
<span class="go">    git:3.9.1</span>
<span class="go">    blueocean:1.4.1</span>
<span class="go">    ghprb:1.40.0</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/test-config.yaml
<span class="go">apiVersion: v1</span>
<span class="go">kind: ConfigMap</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins-tests</span>
<span class="go">data:</span>
<span class="go">  run.sh: |-</span>
<span class="go">    @test &quot;Testing Jenkins UI is accessible&quot; {</span>
<span class="go">      curl --retry 48 --retry-delay 10 jenkins:8080/login</span>
<span class="go">    }</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/home-pvc.yaml
<span class="go">kind: PersistentVolumeClaim</span>
<span class="go">apiVersion: v1</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins</span>
<span class="go">  labels:</span>
<span class="go">    app: jenkins</span>
<span class="go">    chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">    release: &quot;jenkins&quot;</span>
<span class="go">    heritage: &quot;Tiller&quot;</span>
<span class="go">spec:</span>
<span class="go">  accessModes:</span>
<span class="go">    - &quot;ReadWriteOnce&quot;</span>
<span class="go">  resources:</span>
<span class="go">    requests:</span>
<span class="go">      storage: &quot;8Gi&quot;</span>
<span class="go">  storageClassName: &quot;ontap-gold&quot;</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/jenkins-agent-svc.yaml
<span class="go">apiVersion: v1</span>
<span class="go">kind: Service</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins-agent</span>
<span class="go">  labels:</span>
<span class="go">    app: jenkins</span>
<span class="go">    chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">    component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">spec:</span>
<span class="go">  ports:</span>
<span class="go">    - port: 50000</span>
<span class="go">      targetPort: 50000</span>

<span class="go">      name: slavelistener</span>
<span class="go">  selector:</span>
<span class="go">    component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">  type: ClusterIP</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/jenkins-master-svc.yaml
<span class="go">apiVersion: v1</span>
<span class="go">kind: Service</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins</span>
<span class="go">  labels:</span>
<span class="go">    app: jenkins</span>
<span class="go">    heritage: &quot;Tiller&quot;</span>
<span class="go">    release: &quot;jenkins&quot;</span>
<span class="go">    chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">    component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">spec:</span>
<span class="go">  ports:</span>
<span class="go">    - port: 8080</span>
<span class="go">      name: http</span>
<span class="go">      targetPort: 8080</span>

<span class="go">  selector:</span>
<span class="go">    component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">  type: LoadBalancer</span>

<span class="go">  loadBalancerSourceRanges:</span>
<span class="go">    - 0.0.0.0/0</span>
<span class="go">---</span>
<span class="gp">#</span> Source: jenkins/templates/jenkins-master-deployment.yaml
<span class="go">apiVersion: extensions/v1beta1</span>
<span class="go">kind: Deployment</span>
<span class="go">metadata:</span>
<span class="go">  name: jenkins</span>
<span class="go">  labels:</span>
<span class="go">    heritage: &quot;Tiller&quot;</span>
<span class="go">    release: &quot;jenkins&quot;</span>
<span class="go">    chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">    component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">spec:</span>
<span class="go">  replicas: 1</span>
<span class="go">  strategy:</span>
<span class="go">    type: RollingUpdate</span>
<span class="go">  selector:</span>
<span class="go">    matchLabels:</span>
<span class="go">      component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">  template:</span>
<span class="go">    metadata:</span>
<span class="go">      labels:</span>
<span class="go">        app: jenkins</span>
<span class="go">        heritage: &quot;Tiller&quot;</span>
<span class="go">        release: &quot;jenkins&quot;</span>
<span class="go">        chart: &quot;jenkins-0.16.20&quot;</span>
<span class="go">        component: &quot;jenkins-jenkins-master&quot;</span>
<span class="go">      annotations:</span>
<span class="go">        checksum/config: f1949fdff0e0d3db7c6180357f63c007db61b13e5c107e5980a5eac982863c21</span>
<span class="go">    spec:</span>
<span class="go">      securityContext:</span>
<span class="go">        runAsUser: 0</span>
<span class="go">      serviceAccountName: &quot;default&quot;</span>
<span class="go">      initContainers:</span>
<span class="go">        - name: &quot;copy-default-config&quot;</span>
<span class="go">          image: &quot;jenkins/jenkins:lts&quot;</span>
<span class="go">          imagePullPolicy: &quot;Always&quot;</span>
<span class="go">          command: [ &quot;sh&quot;, &quot;/var/jenkins_config/apply_config.sh&quot; ]</span>
<span class="go">          resources:</span>
<span class="go">            limits:</span>
<span class="go">              cpu: 2000m</span>
<span class="go">              memory: 2048Mi</span>
<span class="go">            requests:</span>
<span class="go">              cpu: 50m</span>
<span class="go">              memory: 256Mi</span>

<span class="go">          volumeMounts:</span>
<span class="go">            -</span>
<span class="go">              mountPath: /var/jenkins_home</span>
<span class="go">              name: jenkins-home</span>
<span class="go">            -</span>
<span class="go">              mountPath: /var/jenkins_config</span>
<span class="go">              name: jenkins-config</span>
<span class="go">            -</span>
<span class="go">              mountPath: /var/jenkins_plugins</span>
<span class="go">              name: plugin-dir</span>
<span class="go">            -</span>
<span class="go">              mountPath: /usr/share/jenkins/ref/secrets/</span>
<span class="go">              name: secrets-dir</span>
<span class="go">      containers:</span>
<span class="go">        - name: jenkins</span>
<span class="go">          image: &quot;jenkins/jenkins:lts&quot;</span>
<span class="go">          imagePullPolicy: &quot;Always&quot;</span>
<span class="go">          args: [ &quot;--argumentsRealm.passwd.$(ADMIN_USER)=$(ADMIN_PASSWORD)&quot;,  &quot;--argumentsRealm.roles.$(ADMIN_USER)=admin&quot;]</span>
<span class="go">          env:</span>
<span class="go">            - name: JAVA_TOOL_OPTIONS</span>
<span class="go">              value: &quot;&quot;</span>
<span class="go">            - name: JENKINS_OPTS</span>
<span class="go">              value: &quot;&quot;</span>
<span class="go">            - name: ADMIN_PASSWORD</span>
<span class="go">              valueFrom:</span>
<span class="go">                secretKeyRef:</span>
<span class="go">                  name: jenkins</span>
<span class="go">                  key: jenkins-admin-password</span>
<span class="go">            - name: ADMIN_USER</span>
<span class="go">              valueFrom:</span>
<span class="go">                secretKeyRef:</span>
<span class="go">                  name: jenkins</span>
<span class="go">                  key: jenkins-admin-user</span>
<span class="go">          ports:</span>
<span class="go">            - containerPort: 8080</span>
<span class="go">              name: http</span>
<span class="go">            - containerPort: 50000</span>
<span class="go">              name: slavelistener</span>
<span class="go">          livenessProbe:</span>
<span class="go">            httpGet:</span>
<span class="go">              path: &quot;/login&quot;</span>
<span class="go">              port: http</span>
<span class="go">            initialDelaySeconds: 90</span>
<span class="go">            timeoutSeconds: 5</span>
<span class="go">            failureThreshold: 12</span>
<span class="go">          readinessProbe:</span>
<span class="go">            httpGet:</span>
<span class="go">              path: &quot;/login&quot;</span>
<span class="go">              port: http</span>
<span class="go">            initialDelaySeconds: 60</span>
<span class="gp">          #</span> Resources configuration is a little hacky. This was to prevent breaking
<span class="gp">          #</span> changes, and should be cleanned up in the future once everybody had
<span class="gp">          #</span> enough <span class="nb">time</span> to migrate.
<span class="go">          resources:</span>

<span class="go">            limits:</span>
<span class="go">              cpu: 2000m</span>
<span class="go">              memory: 2048Mi</span>
<span class="go">            requests:</span>
<span class="go">              cpu: 50m</span>
<span class="go">              memory: 256Mi</span>


<span class="go">          volumeMounts:</span>
<span class="go">            -</span>
<span class="go">              mountPath: /var/jenkins_home</span>
<span class="go">              name: jenkins-home</span>
<span class="go">              readOnly: false</span>
<span class="go">            -</span>
<span class="go">              mountPath: /var/jenkins_config</span>
<span class="go">              name: jenkins-config</span>
<span class="go">              readOnly: true</span>
<span class="go">            -</span>
<span class="go">              mountPath: /usr/share/jenkins/ref/plugins/</span>
<span class="go">              name: plugin-dir</span>
<span class="go">              readOnly: false</span>
<span class="go">            -</span>
<span class="go">              mountPath: /usr/share/jenkins/ref/secrets/</span>
<span class="go">              name: secrets-dir</span>
<span class="go">              readOnly: false</span>
<span class="go">      volumes:</span>
<span class="go">      - name: jenkins-config</span>
<span class="go">        configMap:</span>
<span class="go">          name: jenkins</span>
<span class="go">      - name: plugin-dir</span>
<span class="go">        emptyDir: {}</span>
<span class="go">      - name: secrets-dir</span>
<span class="go">        emptyDir: {}</span>
<span class="go">      - name: jenkins-home</span>
<span class="go">        persistentVolumeClaim:</span>
<span class="go">          claimName: jenkins</span>
<span class="go">LAST DEPLOYED: Mon Aug 27 23:54:09 2018</span>
<span class="go">NAMESPACE: jenkins</span>
<span class="go">STATUS: DEPLOYED</span>

<span class="go">RESOURCES:</span>
<span class="go">==&gt; v1/Secret</span>
<span class="go">NAME     TYPE    DATA  AGE</span>
<span class="go">jenkins  Opaque  2     0s</span>

<span class="go">==&gt; v1/ConfigMap</span>
<span class="go">NAME           DATA  AGE</span>
<span class="go">jenkins        5     0s</span>
<span class="go">jenkins-tests  1     0s</span>

<span class="go">==&gt; v1/PersistentVolumeClaim</span>
<span class="go">NAME     STATUS   VOLUME      CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span>
<span class="go">jenkins  Pending  ontap-gold  0s</span>

<span class="go">==&gt; v1/Service</span>
<span class="go">NAME           TYPE          CLUSTER-IP     EXTERNAL-IP     PORT(S)         AGE</span>
<span class="go">jenkins-agent  ClusterIP     10.109.172.86  &lt;none&gt;          50000/TCP       0s</span>
<span class="go">jenkins        LoadBalancer  10.97.161.136  192.168.10.210  8080:30376/TCP  0s</span>

<span class="go">==&gt; v1beta1/Deployment</span>
<span class="go">NAME     DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span>
<span class="go">jenkins  1        1        1           0          0s</span>

<span class="go">==&gt; v1/Pod(related)</span>
<span class="go">NAME                     READY  STATUS   RESTARTS  AGE</span>
<span class="go">jenkins-965668c95-7tzmc  0/1    Pending  0         0s</span>


<span class="go">NOTES:</span>
<span class="go">1. Get your &#39;admin&#39; user password by running:</span>
<span class="go">  printf $(kubectl get secret --namespace jenkins jenkins -o jsonpath=&quot;{.data.jenkins-admin-password}&quot; | base64 --decode);echo</span>
<span class="go">2. Get the Jenkins URL to visit by running these commands in the same shell:</span>
<span class="go">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span>
<span class="go">        You can watch the status of by running &#39;kubectl get svc --namespace jenkins -w jenkins&#39;</span>
<span class="go">  export SERVICE_IP=$(kubectl get svc --namespace jenkins jenkins --template &quot;{{ range (index .status.loadBalancer.ingress 0) }}{{ . }}{{ end }}&quot;)</span>
<span class="go">  echo http://$SERVICE_IP:8080/login</span>

<span class="go">3. Login with the password from step 1 and the username: admin</span>

<span class="go">For more information on running Jenkins on Kubernetes, visit:</span>
<span class="go">https://cloud.google.com/solutions/jenkins-on-container-engine</span>
</pre></div>
</div>
<p>「NOTES」欄に記載の通りadminパスワードを取得します。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">printf</span> <span class="k">$(</span>kubectl get secret --namespace jenkins jenkins -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.jenkins-admin-password}&quot;</span> <span class="p">|</span> base64 --decode<span class="k">)</span><span class="p">;</span><span class="nb">echo</span>

<span class="go">    sShJg2gig9</span>
</pre></div>
</div>
<p>以上で、Jenkinsのデプロイが完了しました。</p>
</div>
<div class="section" id="id2">
<h1>Helmが生成するマニフェストファイル<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Helmを使いvalues.yamlを定義するとどのようなマニフェストファイルが生成されるかが予測しづらいこともあります。</p>
<p>その場合には <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> と <code class="docutils literal notranslate"><span class="pre">--debug</span></code> を付与することでデプロイメントされるYAMLファイルが出力されます。</p>
<blockquote>
<div>helm --namespace jenkins --name jenkins -f ./values.yaml install stable/jenkins --dry-run --debug</div></blockquote>
</div>
<div class="section" id="values-yamltry-error">
<h1>values.yamlのTry &amp; Error: インストールが上手くいかない場合は？<a class="headerlink" href="#values-yamltry-error" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>values.yamlを試行錯誤しながら設定していくことになると思います。
一度デプロイメントしたHelmチャートは以下のコマンドで削除することができます。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> helm del --purge チャート名
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, NetApp.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'18.08 NDX vol2',
            LANGUAGE:'ja',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>